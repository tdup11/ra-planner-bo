"use strict";(self.webpackChunkRAPlanner=self.webpackChunkRAPlanner||[]).push([[225],{8225:(G,b,r)=>{r.r(b),r.d(b,{RaModule:()=>P});var d=r(9808),f=r(9762),t=r(7587),p=r(2025),M=r(8759),v=r(9783),u=r(1745),m=r(1365),_=r(5163),T=r(4119);function y(n,a){1&n&&(t.TgZ(0,"tr"),t._UZ(1,"th"),t.TgZ(2,"th",3),t._uU(3,"\xc9quipe"),t.qZA(),t.TgZ(4,"th"),t._uU(5,"R\xe9sultats"),t.qZA()())}function Z(n,a){1&n&&t._UZ(0,"i",10)}function O(n,a){1&n&&t._UZ(0,"i",11)}function x(n,a){1&n&&t._UZ(0,"i",12)}function R(n,a){if(1&n&&(t.ynx(0)(1,5),t.TgZ(2,"span",6),t.YNc(3,Z,1,0,"i",7),t.YNc(4,O,1,0,"i",8),t.YNc(5,x,1,0,"i",9),t.qZA(),t.BQk()()),2&n){const e=a.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("ngSwitch",e.getOutcome()),t.xp6(1),t.Q6J("pTooltip",o.getResultString(e))("escape",!1),t.xp6(1),t.Q6J("ngSwitchCase",o.outcomeEnum.WIN),t.xp6(1),t.Q6J("ngSwitchCase",o.outcomeEnum.LOSS),t.xp6(1),t.Q6J("ngSwitchCase",o.outcomeEnum.BYE)}}function B(n,a){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",3)(4,"p"),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA()(),t.TgZ(8,"td"),t.YNc(9,R,6,6,"ng-container",4),t.qZA()()),2&n){const e=a.$implicit,o=a.rowIndex;t.xp6(2),t.hij(" ",o+1," "),t.xp6(3),t.AsE("",e.playerOne.firstName," ",e.playerOne.lastName,""),t.xp6(2),t.AsE("",e.playerTwo.firstName," ",e.playerTwo.lastName,""),t.xp6(2),t.Q6J("ngForOf",e.results)}}let I=(()=>{class n{constructor(e){this.boardService=e,this.boardId="",this.board=m.$.empty(),this.subscriptions=[],this.outcomeEnum=u.j}ngOnInit(){this.boardId&&this.subscriptions.push(this.boardService.getBoard(this.boardId).subscribe(e=>{const o=m.$.deepCopy(e);this.sortTeamsByRank(o),this.board=o}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}sortTeamsByRank(e){e.teams.sort((o,i)=>{const s=o.getOutcomes(),c=i.getOutcomes();if(s.length>c.length)return-1;if(s.length<c.length)return 1;for(let l=0;l<s.length;l++){if(s[l]!==u.j.WIN&&c[l]===u.j.WIN)return 1;if(s[l]===u.j.WIN&&c[l]!==u.j.WIN)return-1}for(let l=0;l<s.length;l++){if(s[l]===u.j.BYE&&c[l]!==u.j.BYE)return-1;if(s[l]!==u.j.BYE&&c[l]===u.j.BYE)return 1}return o.id.localeCompare(i.id)})}getResultString(e){const o=(0,u.M)(e.getOutcome()),i=this.board.teams.find(s=>s.id===e.opponentId);return o+" contre <br>"+i.playerOne.getShortFullName()+" - "+i.playerTwo.getShortFullName()+"<br>"+e.sets.map(s=>s.toString()).reduce((s,c,l,V)=>s+", "+c)+"<br>"}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.$))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-board-table"]],inputs:{boardId:"boardId"},decls:3,vars:1,consts:[[3,"value"],["pTemplate","header"],["pTemplate","body"],[1,"p-1"],[4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"pTooltip","escape"],["class","fas fa-circle-check ml-1 win-color",4,"ngSwitchCase"],["class","fa-solid fa-circle-xmark ml-1 loss-color",4,"ngSwitchCase"],["class","fa-solid fa-circle-minus ml-1 bye-color",4,"ngSwitchCase"],[1,"fas","fa-circle-check","ml-1","win-color"],[1,"fa-solid","fa-circle-xmark","ml-1","loss-color"],[1,"fa-solid","fa-circle-minus","ml-1","bye-color"]],template:function(e,o){1&e&&(t.TgZ(0,"p-table",0),t.YNc(1,y,6,0,"ng-template",1),t.YNc(2,B,10,6,"ng-template",2),t.qZA()),2&e&&t.Q6J("value",o.board.teams)},directives:[_.iA,v.jx,d.sg,d.RF,T.u,d.n9],styles:[""]}),n})();function A(n,a){if(1&n&&(t.TgZ(0,"div",2)(1,"h2",3),t._uU(2),t.qZA(),t._UZ(3,"app-board-table",4),t.qZA()),2&n){const e=a.$implicit;t.xp6(2),t.hij("Tableau ",e,""),t.xp6(1),t.Q6J("boardId",e)}}let w=(()=>{class n{constructor(e){this.boardService=e,this.boardIds=[],this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.boardService.getAllBoardIds().subscribe(e=>{this.boardIds=e}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.$))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ra-results"]],decls:2,vars:2,consts:[[3,"value","circular"],["pTemplate","item"],[1,"flex","flex-column"],[1,"align-self-center","mt-0"],[3,"boardId"]],template:function(e,o){1&e&&(t.TgZ(0,"p-carousel",0),t.YNc(1,A,4,2,"ng-template",1),t.qZA()),2&e&&t.Q6J("value",o.boardIds)("circular",!0)},directives:[M.l,v.jx,I],styles:[""]}),n})();var N=r(2638),g=r(6333),h=r(996),S=r(727);let F=(()=>{class n{constructor(e){this.boardService=e}createByeResult(){return new g.x("BYE",[],this.boardService.getWinningSets(),!0,new Date)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(p.$))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var J=r(97),Q=r(2324),Y=r(7599),j=r(7010),C=r(2382),E=r(845);function U(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",1)(1,"p-inputNumber",11),t.NdJ("ngModelChange",function(i){return t.CHM(e).$implicit.selfScore=i}),t.qZA(),t.TgZ(2,"span",3),t._uU(3,"-"),t.qZA(),t.TgZ(4,"p-inputNumber",12),t.NdJ("ngModelChange",function(i){return t.CHM(e).$implicit.opponentScore=i}),t.qZA()()}if(2&n){const e=a.$implicit;t.xp6(1),t.Q6J("size",1)("ngModel",e.selfScore)("min",0),t.xp6(3),t.Q6J("size",1)("ngModel",e.opponentScore)("min",0)}}let $=(()=>{class n{constructor(e,o){this.boardService=e,this.courtService=o,this.onSendResult=new t.vpe,this.onMatchSaved=new t.vpe,this.availableCourts=[],this._court=null,this.canSaveMatch=!1,this.maxAvailableCourts=0,this.tooltip=""}ngOnInit(){this.maxAvailableCourts=this.courtService.getMaxAvailableCourts(),this.courtService.getAvailableCourts().subscribe(e=>{this.availableCourts=e.slice().sort(),this.tooltip=this.availableCourts.toString()}),this.court=this.match.court}get court(){return this._court}set court(e){this.canSaveMatch=null===e||this.availableCourts.includes(e)||this.match.court===e,this._court=e}addSet(){this.match.sets.push(new h.l(null,null))}saveMatch(){this.courtService.unlockCourt(this.match.court),this.courtService.lockCourt(this.court),this.match.court=this.court,this.onMatchSaved.emit(this.match)}sendResult(){this.onSendResult.emit(this.match)}canAddSet(){return this.match.sets.length<2*this.boardService.getWinningSets()-1}canSendResult(){return(0,Q.s)(this.match.sets,this.boardService.getWinningSets())!==u.j.IN_PROGRESS}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.$),t.Y36(Y.H))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ongoing-match"]],inputs:{match:"match",teamOne:"teamOne",teamTwo:"teamTwo"},outputs:{onSendResult:"onSendResult",onMatchSaved:"onMatchSaved"},decls:20,vars:12,consts:[[1,"flex","flex-column","gap-1"],[1,"grid"],[1,"col-5"],[1,"col-2","align-self-center","text-center"],[1,"col-5","text-right"],["class","grid",4,"ngFor","ngForOf"],[1,"flex","gap-1","justify-content-between"],["pButton","","icon","fas fa-plus","pTooltip","Ajouter un set",3,"disabled","click"],["pButton","","icon","fas fa-floppy-disk","pTooltip","Sauvegarder",3,"disabled","click"],["pButton","","icon","fas fa-check","pTooltip","Valider le match",1,"p-button-success",3,"disabled","click"],["mode","decimal","prefix","Terrain n\xb0 ",3,"ngModel","min","max","pTooltip","ngModelChange"],["mode","decimal",1,"col-5","justify-content-start",3,"size","ngModel","min","ngModelChange"],["mode","decimal",1,"col-5","justify-content-end",3,"size","ngModel","min","ngModelChange"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"p"),t._uU(4),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA()(),t.TgZ(7,"span",3),t._uU(8,"-"),t.qZA(),t.TgZ(9,"div",4)(10,"p"),t._uU(11),t.qZA(),t.TgZ(12,"p"),t._uU(13),t.qZA()()(),t.YNc(14,U,5,6,"div",5),t.TgZ(15,"div",6)(16,"button",7),t.NdJ("click",function(){return o.addSet()}),t.qZA(),t.TgZ(17,"button",8),t.NdJ("click",function(){return o.saveMatch()}),t.qZA(),t.TgZ(18,"button",9),t.NdJ("click",function(){return o.sendResult()}),t.qZA(),t.TgZ(19,"p-inputNumber",10),t.NdJ("ngModelChange",function(s){return o.court=s}),t.qZA()()()),2&e&&(t.xp6(4),t.Oqu(o.teamOne.playerOne.getFullName()),t.xp6(2),t.Oqu(o.teamOne.playerTwo.getFullName()),t.xp6(5),t.Oqu(o.teamTwo.playerOne.getFullName()),t.xp6(2),t.Oqu(o.teamTwo.playerTwo.getFullName()),t.xp6(1),t.Q6J("ngForOf",o.match.sets),t.xp6(2),t.Q6J("disabled",!o.canAddSet()),t.xp6(1),t.Q6J("disabled",!o.canSaveMatch),t.xp6(1),t.Q6J("disabled",!o.canSendResult()),t.xp6(1),t.Q6J("ngModel",o.court)("min",1)("max",o.maxAvailableCourts)("pTooltip",o.tooltip))},directives:[d.sg,j.Rn,C.JJ,C.On,E.Hq,T.u],styles:[""]}),n})();function q(n,a){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-ongoing-match",3),t.NdJ("onMatchSaved",function(i){return t.CHM(e),t.oxw().saveMatch(i)})("onSendResult",function(i){return t.CHM(e),t.oxw().addResultToTeams(i)}),t.qZA(),t.BQk()}if(2&n){const e=a.$implicit,o=t.oxw();t.xp6(1),t.Q6J("match",e)("teamOne",o.getTeam(e.teamOneId))("teamTwo",o.getTeam(e.teamTwoId))}}let W=(()=>{class n{constructor(e,o){this.boardService=e,this.matchService=o,this._boardId="",this.board=m.$.empty(),this.turnMessage=[],this.currentBoardSubscription=new S.w0}set boardId(e){this._boardId=e,this.currentBoardSubscription.unsubscribe(),this.currentBoardSubscription=this.getBoardSubscription(e)}get boardId(){return this._boardId}ngOnInit(){this.currentBoardSubscription=this.getBoardSubscription(this.boardId)}ngOnDestroy(){this.currentBoardSubscription.unsubscribe()}canGenerateMatches(){return 0!==this.board.teams.length&&this.board.teams.every(e=>e.results.length===this.board.turn-1)&&0===this.board.ongoingMatches.length&&!this.board.isFinished()}generateNewMatches(){const e=new Map;for(let i=0;i<2**this.board.turn-1;i++)e.set(i,[]);this.board.teams.forEach(i=>{let s=0;i.results.sort(g.x.sort).forEach((c,l)=>{c.getOutcome()===u.j.WIN&&(s+=2**l)}),e.get(s).push(i)});const o=[];for(let i of e.values()){i=i.sort((s,c)=>s.id.localeCompare(c.id));for(let s=0;s<i.length;s+=2)s===i.length-1&&i.length%2==1?i[s].results.push(this.matchService.createByeResult()):o.push(new N.q(i[s].id,i[s+1].id,[],null))}this.board.ongoingMatches=o,this.boardService.setBoard(this.board)}addResultToTeams(e){const o=this.board.teams.find(s=>s.id===e.teamOneId),i=this.board.teams.find(s=>s.id===e.teamTwoId);o.results.push(new g.x(i.id,e.sets.map(h.l.deepCopy),this.boardService.getWinningSets(),!1,new Date)),i.results.push(new g.x(o.id,e.sets.map(h.l.reverseDeepCopy),this.boardService.getWinningSets(),!1,new Date)),this.board.ongoingMatches=this.board.ongoingMatches.filter(s=>s.id!==e.id),!this.board.isFinished()&&this.board.teams.every(s=>s.results.length===this.board.turn)&&this.board.turn++,this.boardService.setBoard(this.board)}saveMatch(e){const o=this.board.ongoingMatches.findIndex(i=>i.id===e.id);-1!==o&&(this.board.ongoingMatches[o]=e,this.boardService.setBoard(this.board))}getBoardSubscription(e){return e?this.boardService.getBoard(e).subscribe(o=>{this.board=m.$.deepCopy(o),this.turnMessage=[{severity:this.board.isFinished()?"error":"success",summary:"Tableau "+e+" : Tour "+this.board.turn+" sur "+this.board.turnsToBePlayed,icon:this.board.isFinished()?"fa-solid fa-circle-stop":"fa-solid fa-circle-play"}],this.canGenerateMatches()&&this.generateNewMatches()}):new S.w0}getTeam(e){return this.board.teams.find(o=>o.id===e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.$),t.Y36(F))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-board-ongoing-matches"]],inputs:{boardId:"boardId"},decls:3,vars:3,consts:[[3,"value","closable"],[1,"two-items-grid"],[4,"ngFor","ngForOf"],[3,"match","teamOne","teamTwo","onMatchSaved","onSendResult"]],template:function(e,o){1&e&&(t._UZ(0,"p-messages",0),t.TgZ(1,"div",1),t.YNc(2,q,2,3,"ng-container",2),t.qZA()),2&e&&(t.Q6J("value",o.turnMessage)("closable",!1),t.xp6(2),t.Q6J("ngForOf",o.board.ongoingMatches))},directives:[J.V,d.sg,$],styles:[".two-items-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;grid-auto-rows:minmax(0,auto);grid-column-gap:1rem;column-gap:1rem;grid-row-gap:2rem;row-gap:2rem}"]}),n})();function z(n,a){if(1&n&&(t.ynx(0),t._UZ(1,"app-board-ongoing-matches",2),t.BQk()),2&n){const e=a.$implicit;t.xp6(1),t.Q6J("boardId",e)}}let D=(()=>{class n{constructor(e){this.boardService=e,this.boardIds=[],this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.boardService.getAllBoardIds().subscribe(e=>{this.boardIds=e.slice()}))}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(p.$))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ra-matches"]],decls:2,vars:1,consts:[[1,"flex","flex-column","gap-2","align-items-center"],[4,"ngFor","ngForOf"],[3,"boardId"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.YNc(1,z,2,1,"ng-container",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",o.boardIds))},directives:[d.sg,W],styles:[""]}),n})();const H=[{path:"",component:(()=>{class n{constructor(){}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ra"]],decls:5,vars:0,consts:[[1,"grid","mt-3"],[1,"col-6"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"app-ra-results"),t.qZA(),t.TgZ(3,"div",1),t._UZ(4,"app-ra-matches"),t.qZA()())},directives:[w,D],styles:[""]}),n})()}];let X=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[f.Bz.forChild(H)],f.Bz]}),n})();var k=r(6997);let P=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[d.ez,X,k.m]]}),n})()}}]);