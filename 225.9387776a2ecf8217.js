"use strict";(self.webpackChunkRAPlanner=self.webpackChunkRAPlanner||[]).push([[225],{8225:(D,f,i)=>{i.r(f),i.d(f,{RaModule:()=>P});var m=i(9808),b=i(9762),p=i(1365),t=i(7587),u=i(2025),_=i(8759),C=i(9783),d=i(1745),M=i(5163),T=i(4119);function x(n,r){1&n&&(t.TgZ(0,"tr"),t._UZ(1,"th"),t.TgZ(2,"th",3),t._uU(3,"\xc9quipe"),t.qZA(),t.TgZ(4,"th"),t._uU(5,"R\xe9sultats"),t.qZA()())}function S(n,r){1&n&&t._UZ(0,"i",10)}function Z(n,r){1&n&&t._UZ(0,"i",11)}function y(n,r){1&n&&t._UZ(0,"i",12)}function O(n,r){if(1&n&&(t.ynx(0)(1,5),t.TgZ(2,"span",6),t.YNc(3,S,1,0,"i",7),t.YNc(4,Z,1,0,"i",8),t.YNc(5,y,1,0,"i",9),t.qZA(),t.BQk()()),2&n){const e=r.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("ngSwitch",e.getOutcome()),t.xp6(1),t.Q6J("pTooltip",o.getResultString(e))("escape",!1),t.xp6(1),t.Q6J("ngSwitchCase",o.outcomeEnum.WIN),t.xp6(1),t.Q6J("ngSwitchCase",o.outcomeEnum.LOSS),t.xp6(1),t.Q6J("ngSwitchCase",o.outcomeEnum.BYE)}}function R(n,r){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",3)(4,"p"),t._uU(5),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA()(),t.TgZ(8,"td"),t.YNc(9,O,6,6,"ng-container",4),t.qZA()()),2&n){const e=r.$implicit,o=r.rowIndex;t.xp6(2),t.hij(" ",o+1," "),t.xp6(3),t.AsE("",e.playerOne.firstName," ",e.playerOne.lastName,""),t.xp6(2),t.AsE("",e.playerTwo.firstName," ",e.playerTwo.lastName,""),t.xp6(2),t.Q6J("ngForOf",e.results)}}let B=(()=>{class n{constructor(){this._board=p.$.empty(),this.outcomeEnum=d.j}set board(e){const o=p.$.deepCopy(e);this.sortTeamsByRank(o),this._board=o}get board(){return this._board}ngOnInit(){}sortTeamsByRank(e){e.teams.sort((o,a)=>{const s=o.getOutcomes(),c=a.getOutcomes();if(s.length>c.length)return-1;if(s.length<c.length)return 1;for(let l=0;l<s.length;l++){if(s[l]!==d.j.WIN&&c[l]===d.j.WIN)return 1;if(s[l]===d.j.WIN&&c[l]!==d.j.WIN)return-1}for(let l=0;l<s.length;l++){if(s[l]===d.j.BYE&&c[l]!==d.j.BYE)return-1;if(s[l]!==d.j.BYE&&c[l]===d.j.BYE)return 1}return o.id.localeCompare(a.id)})}getResultString(e){const o=(0,d.M)(e.getOutcome()),a=this.board.teams.find(s=>s.id===e.opponentId);return o+" contre <br>"+a.playerOne.getShortFullName()+" - "+a.playerTwo.getShortFullName()+"<br>"+e.sets.map(s=>s.toString()).reduce((s,c,l,L)=>s+", "+c)+"<br>"}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-board-table"]],inputs:{board:"board"},decls:3,vars:1,consts:[[3,"value"],["pTemplate","header"],["pTemplate","body"],[1,"p-1"],[4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"pTooltip","escape"],["class","fas fa-circle-check ml-1 win-color",4,"ngSwitchCase"],["class","fa-solid fa-circle-xmark ml-1 loss-color",4,"ngSwitchCase"],["class","fa-solid fa-circle-minus ml-1 bye-color",4,"ngSwitchCase"],[1,"fas","fa-circle-check","ml-1","win-color"],[1,"fa-solid","fa-circle-xmark","ml-1","loss-color"],[1,"fa-solid","fa-circle-minus","ml-1","bye-color"]],template:function(e,o){1&e&&(t.TgZ(0,"p-table",0),t.YNc(1,x,6,0,"ng-template",1),t.YNc(2,R,10,6,"ng-template",2),t.qZA()),2&e&&t.Q6J("value",o.board.teams)},directives:[M.iA,C.jx,m.sg,m.RF,T.u,m.n9],styles:[""]}),n})();function w(n,r){if(1&n&&(t.TgZ(0,"div",2)(1,"h2",3),t._uU(2),t.qZA(),t._UZ(3,"app-board-table",4),t.qZA()),2&n){const e=r.$implicit;t.xp6(2),t.hij("Tableau ",e.id,""),t.xp6(1),t.Q6J("board",e)}}let A=(()=>{class n{constructor(){this.boards=[]}ngOnInit(){}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ra-results"]],inputs:{boards:"boards"},decls:2,vars:2,consts:[[3,"value","circular"],["pTemplate","item"],[1,"flex","flex-column"],[1,"align-self-center","mt-0"],[3,"board"]],template:function(e,o){1&e&&(t.TgZ(0,"p-carousel",0),t.YNc(1,w,4,2,"ng-template",1),t.qZA()),2&e&&t.Q6J("value",o.boards)("circular",!0)},directives:[_.l,C.jx,B],styles:[""]}),n})();var N=i(2638),g=i(6333),h=i(996);let F=(()=>{class n{constructor(e){this.boardService=e}createByeResult(){return new g.x("BYE",[],this.boardService.getWinningSets(),!0,new Date)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(u.$))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var J=i(97),I=i(2324),Q=i(7599),Y=i(7010),v=i(2382),j=i(845);function E(n,r){if(1&n){const e=t.EpF();t.TgZ(0,"div",1)(1,"p-inputNumber",10),t.NdJ("ngModelChange",function(a){return t.CHM(e).$implicit.selfScore=a}),t.qZA(),t.TgZ(2,"span",3),t._uU(3,"-"),t.qZA(),t.TgZ(4,"p-inputNumber",11),t.NdJ("ngModelChange",function(a){return t.CHM(e).$implicit.opponentScore=a}),t.qZA()()}if(2&n){const e=r.$implicit;t.xp6(1),t.Q6J("size",1)("ngModel",e.selfScore)("min",0),t.xp6(3),t.Q6J("size",1)("ngModel",e.opponentScore)("min",0)}}let U=(()=>{class n{constructor(e,o){this.boardService=e,this.courtService=o,this.matchChange=new t.vpe,this.onSendResult=new t.vpe,this.availableCourts=[],this.maxAvailableCourts=0,this.tooltip=""}ngOnInit(){this.maxAvailableCourts=this.courtService.getMaxAvailableCourts(),this.courtService.getAvailableCourts().subscribe(e=>{this.availableCourts=e.slice().sort(),this.tooltip=this.availableCourts.toString()})}get court(){return this.match.court}set court(e){this.courtService.unlockCourt(this.match.court),this.match.court=null===e||this.availableCourts.includes(e)||this.match.court===e?e:null,this.courtService.lockCourt(this.match.court),this.matchChange.emit(this.match)}addSet(){this.match.sets.push(new h.l(null,null))}sendResult(){this.courtService.unlockCourt(this.match.court),this.onSendResult.emit(this.match)}canAddSet(){return this.match.sets.length<2*this.boardService.getWinningSets()-1}canSendResult(){return(0,I.s)(this.match.sets,this.boardService.getWinningSets())!==d.j.IN_PROGRESS&&null!==this.match.court}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(u.$),t.Y36(Q.H))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ongoing-match"]],inputs:{match:"match",teamOne:"teamOne",teamTwo:"teamTwo"},outputs:{matchChange:"matchChange",onSendResult:"onSendResult"},decls:19,vars:11,consts:[[1,"flex","flex-column","gap-1"],[1,"grid"],[1,"col-5"],[1,"col-2","align-self-center","text-center"],[1,"col-5","text-right"],["class","grid",4,"ngFor","ngForOf"],[1,"flex","gap-1","justify-content-between"],["pButton","","icon","fas fa-plus","pTooltip","Ajouter un set",3,"disabled","click"],["pButton","","icon","fas fa-check","pTooltip","Valider le match",1,"p-button-success",3,"disabled","click"],["mode","decimal","prefix","Terrain n\xb0 ",3,"ngModel","min","max","pTooltip","ngModelChange"],["mode","decimal",1,"col-5","justify-content-start",3,"size","ngModel","min","ngModelChange"],["mode","decimal",1,"col-5","justify-content-end",3,"size","ngModel","min","ngModelChange"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"p"),t._uU(4),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA()(),t.TgZ(7,"span",3),t._uU(8,"-"),t.qZA(),t.TgZ(9,"div",4)(10,"p"),t._uU(11),t.qZA(),t.TgZ(12,"p"),t._uU(13),t.qZA()()(),t.YNc(14,E,5,6,"div",5),t.TgZ(15,"div",6)(16,"button",7),t.NdJ("click",function(){return o.addSet()}),t.qZA(),t.TgZ(17,"button",8),t.NdJ("click",function(){return o.sendResult()}),t.qZA(),t.TgZ(18,"p-inputNumber",9),t.NdJ("ngModelChange",function(s){return o.court=s}),t.qZA()()()),2&e&&(t.xp6(4),t.Oqu(o.teamOne.playerOne.getFullName()),t.xp6(2),t.Oqu(o.teamOne.playerTwo.getFullName()),t.xp6(5),t.Oqu(o.teamTwo.playerOne.getFullName()),t.xp6(2),t.Oqu(o.teamTwo.playerTwo.getFullName()),t.xp6(1),t.Q6J("ngForOf",o.match.sets),t.xp6(2),t.Q6J("disabled",!o.canAddSet()),t.xp6(1),t.Q6J("disabled",!o.canSendResult()),t.xp6(1),t.Q6J("ngModel",o.court)("min",1)("max",o.maxAvailableCourts)("pTooltip",o.tooltip))},directives:[m.sg,Y.Rn,v.JJ,v.On,j.Hq,T.u],styles:[""]}),n})();function $(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-ongoing-match",3),t.NdJ("matchChange",function(a){return t.CHM(e),t.oxw().onMatchChange(a)})("onSendResult",function(a){return t.CHM(e),t.oxw().addResultToTeams(a)}),t.qZA(),t.BQk()}if(2&n){const e=r.$implicit,o=t.oxw();t.xp6(1),t.Q6J("match",e)("teamOne",o.getTeam(e.teamOneId))("teamTwo",o.getTeam(e.teamTwoId))}}let q=(()=>{class n{constructor(e,o){this.boardService=e,this.matchService=o,this.board=p.$.empty(),this.boardChange=new t.vpe,this.turnMessage=[]}ngOnInit(){this.canGenerateMatches()&&this.generateNewMatches(),this.updateMessage()}canGenerateMatches(){return 0!==this.board.teams.length&&this.board.teams.every(e=>e.results.length===this.board.turn-1)&&0===this.board.ongoingMatches.length&&!this.board.isFinished()}generateNewMatches(){const e=new Map;for(let a=0;a<2**this.board.turn-1;a++)e.set(a,[]);this.board.teams.forEach(a=>{let s=0;a.results.sort(g.x.sort).forEach((c,l)=>{c.getOutcome()===d.j.WIN&&(s+=2**l)}),e.get(s).push(a)});const o=[];for(let a of e.values()){a=a.sort((s,c)=>s.id.localeCompare(c.id));for(let s=0;s<a.length;s+=2)s===a.length-1&&a.length%2==1?a[s].results.push(this.matchService.createByeResult()):o.push(new N.q(a[s].id,a[s+1].id,[],null))}this.board.ongoingMatches=o,this.updateBoard()}addResultToTeams(e){const o=this.board.teams.find(s=>s.id===e.teamOneId),a=this.board.teams.find(s=>s.id===e.teamTwoId);o.results.push(new g.x(a.id,e.sets.map(h.l.deepCopy),this.boardService.getWinningSets(),!1,new Date)),a.results.push(new g.x(o.id,e.sets.map(h.l.reverseDeepCopy),this.boardService.getWinningSets(),!1,new Date)),this.board.ongoingMatches=this.board.ongoingMatches.filter(s=>s.id!==e.id),!this.board.isFinished()&&this.board.teams.every(s=>s.results.length===this.board.turn)&&this.board.turn++,this.updateBoard()}saveMatch(e){const o=this.board.ongoingMatches.findIndex(a=>a.id===e.id);-1!==o&&(this.board.ongoingMatches[o]=e,this.updateBoard())}getTeam(e){return this.board.teams.find(o=>o.id===e)}updateBoard(){this.canGenerateMatches()&&this.generateNewMatches(),this.updateMessage(),this.boardChange.emit(this.board)}updateMessage(){this.turnMessage=[{severity:this.board.isFinished()?"error":"success",summary:"Tableau "+this.board.id+" : Tour "+this.board.turn+" sur "+this.board.turnsToBePlayed,icon:this.board.isFinished()?"fa-solid fa-circle-stop":"fa-solid fa-circle-play"}]}onMatchChange(e){const o=this.board.ongoingMatches.findIndex(a=>a.id===e.id);-1!==o&&(this.board.ongoingMatches[o]=e,this.updateBoard())}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(u.$),t.Y36(F))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-board-ongoing-matches"]],inputs:{board:"board"},outputs:{boardChange:"boardChange"},decls:3,vars:3,consts:[[3,"value","closable"],[1,"two-items-grid"],[4,"ngFor","ngForOf"],[3,"match","teamOne","teamTwo","matchChange","onSendResult"]],template:function(e,o){1&e&&(t._UZ(0,"p-messages",0),t.TgZ(1,"div",1),t.YNc(2,$,2,3,"ng-container",2),t.qZA()),2&e&&(t.Q6J("value",o.turnMessage)("closable",!1),t.xp6(2),t.Q6J("ngForOf",o.board.ongoingMatches))},directives:[J.V,m.sg,U],styles:[".two-items-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;grid-auto-rows:minmax(0,auto);grid-column-gap:1rem;column-gap:1rem;grid-row-gap:2rem;row-gap:2rem}"]}),n})();function W(n,r){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"app-board-ongoing-matches",2),t.NdJ("boardChange",function(a){return t.CHM(e),t.oxw().onBoardChange(a)}),t.qZA(),t.BQk()}if(2&n){const e=r.$implicit;t.xp6(1),t.Q6J("board",e)}}let z=(()=>{class n{constructor(){this.boards=[],this.boardsChange=new t.vpe}ngOnInit(){}onBoardChange(e){const o=this.boards.findIndex(a=>a.id===e.id);-1!==o&&(this.boards[o]=e,this.boardsChange.emit(this.boards))}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ra-matches"]],inputs:{boards:"boards"},outputs:{boardsChange:"boardsChange"},decls:2,vars:1,consts:[[1,"flex","flex-column","gap-2","align-items-center"],[4,"ngFor","ngForOf"],[3,"board","boardChange"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.YNc(1,W,2,1,"ng-container",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngForOf",o.boards))},directives:[m.sg,q],styles:[""]}),n})();const H=[{path:"",component:(()=>{class n{constructor(e){this.boardService=e,this.boards=[]}ngOnInit(){this.boards=this.boardService.getBoards()}onChangeBoards(e){this.boards=e.map(p.$.deepCopy),this.boardService.setBoards(this.boards)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(u.$))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-ra"]],decls:5,vars:2,consts:[[1,"grid","mt-3"],[1,"col-6"],[3,"boards"],[3,"boards","boardsChange"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._UZ(2,"app-ra-results",2),t.qZA(),t.TgZ(3,"div",1)(4,"app-ra-matches",3),t.NdJ("boardsChange",function(s){return o.onChangeBoards(s)}),t.qZA()()()),2&e&&(t.xp6(2),t.Q6J("boards",o.boards),t.xp6(2),t.Q6J("boards",o.boards))},directives:[A,z],styles:[""]}),n})()}];let X=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[b.Bz.forChild(H)],b.Bz]}),n})();var G=i(6997);let P=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[m.ez,X,G.m]]}),n})()}}]);